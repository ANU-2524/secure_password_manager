{% extends "base.html" %}

{% block content %}
<div style="max-width: 500px; margin: 0 auto;">
  <div class="card">
    <div class="card-header">
      <h2>Add New Credential</h2>
    </div>

    <form method="POST">
      <div class="form-group">
        <label for="service">Service Name (e.g. Google, Netflix)</label>
        <input type="text" id="service" name="service" required autofocus>
      </div>

      <div class="form-group">
        <label for="username">Username / Email</label>
        <input type="text" id="username" name="username" required>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <div class="flex gap-2">
          <input type="password" id="password" name="password" required onkeyup="checkStrength(this.value)">
          <button type="button" class="btn btn-secondary" onclick="togglePassword('password', 'eye-icon')">
            <i class="fas fa-eye" id="eye-icon"></i>
          </button>
        </div>
        <div class="strength-meter">
          <div id="strength-bar" class="strength-bar"></div>
        </div>
      </div>

      <div class="flex gap-2" style="margin-top: 2rem;">
        <button type="submit" class="btn btn-primary btn-block">
          <i class="fas fa-save"></i> Save Credential
        </button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
  function checkStrength(password) {
    const bar = document.getElementById('strength-bar');
    let strength = 0;

    if (password.length > 7) strength += 1;
    if (password.match(/[a-z]+/)) strength += 1;
    if (password.match(/[A-Z]+/)) strength += 1;
    if (password.match(/[0-9]+/)) strength += 1;
    if (password.match(/[$@#&!]+/)) strength += 1;

    switch (strength) {
      case 0:
      case 1:
        bar.style.width = '20%';
        bar.style.backgroundColor = 'var(--danger-color)';
        break;
      case 2:
        bar.style.width = '40%';
        bar.style.backgroundColor = '#f59e0b';
        break;
      case 3:
        bar.style.width = '60%';
        bar.style.backgroundColor = '#f59e0b';
        break;
      case 4:
        bar.style.width = '80%';
        bar.style.backgroundColor = 'var(--success-color)';
        break;
      case 5:
        bar.style.width = '100%';
        bar.style.backgroundColor = 'var(--success-color)';
        break;
    }
  }
</script>
{% endblock %}